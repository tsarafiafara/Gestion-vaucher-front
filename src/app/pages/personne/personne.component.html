<div class="personne-container">
  <div class="header-actions">
    <button class="btn-add" (click)="showModal = true">
      <i class="fas fa-plus"></i> Ajouter un personnel
    </button>
    <button class="btn-refresh" (click)="refresh()">
      <i class="fas fa-sync"></i> Actualiser
    </button>
  </div>

  <!-- Modal -->
  <div class="modal" *ngIf="showModal">
    <div class="modal-overlay" (click)="showModal = false"></div>
    <div class="modal-container">
      <div class="modal-header">
        <h2>
          <i class="fas fa-user-plus"></i>
          {{ isEditMode ? 'Modifier' : 'Ajouter' }} un personnel
        </h2>
        <button class="close-btn" (click)="showModal = false">&times;</button>
      </div>
      <div class="modal-content">
        <form class="personne-form" (ngSubmit)="onSubmit()">
          <div class="form-group">
            <label><i class="fas fa-user"></i> Nom</label>
            <input type="text" [(ngModel)]="personneForm.nom" name="personneNom" required placeholder="Entrez le nom" />
          </div>

          <div class="form-group">
            <label><i class="fas fa-user-tag"></i> Prénom</label>
            <input type="text" [(ngModel)]="personneForm.prenom" name="personnePrenom" required placeholder="Entrez le prénom" />
          </div>

          <div class="form-group">
            <label><i class="fas fa-calendar-alt"></i> Date de naissance</label>
            <input type="date" [(ngModel)]="personneForm.dateNaissance" name="dateNaissance" required />
          </div>

          <div class="form-group">
            <label><i class="fas fa-venus-mars"></i> Sexe</label>
            <select [(ngModel)]="personneForm.sexe" name="personneSexe" required>
              <option value="">Sélectionnez le sexe</option>
              <option value="M">Masculin</option>
              <option value="F">Féminin</option>
            </select>
          </div>

          <div class="form-group">
            <label><i class="fas fa-map-marker-alt"></i> Région</label>
            <select [(ngModel)]="selectedRegion" (change)="onRegionChange()" name="region" required>
              <option value="">Sélectionnez la région</option>
              <option *ngFor="let r of regions" [ngValue]="r">{{ r.nom }}</option>
            </select>
          </div>

          <div class="form-group">
            <label><i class="fas fa-map"></i> District</label>
            <select [(ngModel)]="selectedDistrict" (change)="onDistrictChange()" name="district" required>
              <option value="">Sélectionnez le district</option>
              <option *ngFor="let district of getDistricts()" [ngValue]="district">{{ district.nom }}</option>
            </select>
          </div>

          <div class="form-group">
            <label><i class="fas fa-building"></i> Commune</label>
            <select [(ngModel)]="selectedCommune" name="commune" required>
              <option value="">Sélectionnez la commune</option>
              <option *ngFor="let commune of getCommunes()" [value]="commune">{{ commune }}</option>
            </select>
          </div>

          <div class="form-group">
            <label><i class="fas fa-hospital"></i> Établissement</label>
            <input type="text" [(ngModel)]="etablissement.nom" name="etabNom" required placeholder="Nom de l'établissement" />
          </div>

          <div class="form-actions">
            <button type="button" class="form-submit-btn btn-cancel" (click)="showModal = false">
              <i class="fas fa-times"></i> Annuler
            </button>
            <button type="submit" class="form-submit-btn btn-save">
              <i class="fas fa-save"></i> {{ isEditMode ? 'Modifier' : 'Enregistrer' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Table existante -->
  <div class="table-container">
    <table class="personne-table">
      <thead>
        <tr>
          <th>
            <div class="th-content">
              <i class="fas fa-user"></i>
              <span>Nom</span>
            </div>
          </th>
          <th>
            <div class="th-content">
              <i class="fas fa-user-tag"></i>
              <span>Prénom</span>
            </div>
          </th>
          <th>
            <div class="th-content">
              <i class="fas fa-calendar-alt"></i>
              <span>Date Naissance</span>
            </div>
          </th>
          <th>
            <div class="th-content">
              <i class="fas fa-venus-mars"></i>
              <span>Sexe</span>
            </div>
          </th>
          <th>
            <div class="th-content">
              <i class="fas fa-hospital"></i>
              <span>Établissement</span>
            </div>
          </th>
          <th>
            <div class="th-content">
              <i class="fas fa-cogs"></i>
              <span>Actions</span>
            </div>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of personnes">
          <td>{{ p.nom }}</td>
          <td>{{ p.prenom }}</td>
          <td>{{ p.dateNaissance | date:'dd/MM/yyyy' }}</td>
          <td>
            <span class="gender-badge" [class.male]="p.sexe === 'M'" [class.female]="p.sexe === 'F'">
              {{ p.sexe === 'M' ? 'Masculin' : 'Féminin' }}
            </span>
          </td>
          <td>{{ getEtablissementNom(p.etablissementSanitaireId) }}</td>
          <td class="actions-cell">
            <button class="action-btn edit" (click)="editPersonne(p)" title="Modifier">
              <i class="fas fa-edit"></i>
              <span>Modifier</span>
            </button>
            <button class="action-btn delete" *ngIf="p.id !== undefined" (click)="deletePersonne(p.id)" title="Supprimer">
              <i class="fas fa-trash-alt"></i>
              <span>Supprimer</span>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

