<div class="personne-container">
  <div class="header-actions">
    <button class="btn-add" (click)="showModal = true">
      <i class="fas fa-plus"></i> Ajouter un personnel
    </button>
    <button class="btn-refresh" (click)="refresh()">
      <i class="fas fa-sync"></i> Actualiser
    </button>
  </div>

  <!-- Modal -->
  <div class="modal" *ngIf="showModal">
    <div class="modal-overlay" (click)="showModal = false"></div>
    <div class="modal-container">
      <div class="modal-header">
        <h2>{{ isEditMode ? 'Modifier' : 'Ajouter' }} un personnel</h2>
        <button class="close-btn" (click)="showModal = false">&times;</button>
      </div>
      <div class="modal-content">
        <form class="personne-form" (ngSubmit)="onSubmit()">

          <!-- Personne -->
          <div class="form-group">
            <label>Nom :</label>
            <input type="text" id="nom" [(ngModel)]="personneForm.nom" name="personneNom" required />
          </div>

          <div class="form-group">
            <label>Prénom :</label>
            <input type="text" id="prenom" [(ngModel)]="personneForm.prenom" name="personnePrenom" required />
          </div>

          <div class="form-group">
            <label>Date de naissance :</label>
            <input type="date" id="dateNaissance" [(ngModel)]="personneForm.dateNaissance" name="dateNaissance" required />
          </div>

          <div class="form-group">
            <label>Sexe :</label>
            <select id="sexe" [(ngModel)]="personneForm.sexe" name="personneSexe" required>
              <option value="">-- Sélectionnez --</option>
              <option value="M">Masculin</option>
              <option value="F">Féminin</option>
            </select>
          </div>

          <!-- Etablissement Sanitaire -->
          <div class="form-group">
            <label>Nom Etablissement :</label>
            <input type="text" [(ngModel)]="etablissement.nom" name="etabNom" required />
          </div>

          <div class="form-group">
            <label>Région :</label>
            <select [(ngModel)]="selectedRegion" (change)="onRegionChange()" name="region" required [ngModelOptions]="{standalone: true}">
              <option *ngFor="let r of regions" [ngValue]="r">{{ r.nom }}</option>
            </select>
          </div>

          <div class="form-group">
            <label>District :</label>
            <select [(ngModel)]="selectedDistrict" (change)="onDistrictChange()" name="district" required [ngModelOptions]="{standalone: true}">
              <option *ngFor="let d of selectedRegion?.districts" [ngValue]="d">{{ d.nom }}</option>
            </select>
          </div>

          <div class="form-group">
            <label>Commune :</label>
            <select [(ngModel)]="selectedCommune" name="commune" required [ngModelOptions]="{standalone: true}">
              <option *ngFor="let c of selectedDistrict?.communes" [value]="c">{{ c }}</option>
            </select>
          </div>
          <!-- Bouton -->
          <div class="form-group">
            <button type="submit">{{ isEditMode ? 'Modifier' : 'Ajouter' }}</button>
          </div>

        </form>
      </div>
    </div>
  </div>

  <!-- Table existante -->
  <div class="table-container">
    <table class="personne-table">
      <thead>
        <tr>
          <th>
            <div class="th-content">
              <i class="fas fa-user"></i>
              <span>Nom</span>
            </div>
          </th>
          <th>
            <div class="th-content">
              <i class="fas fa-user-tag"></i>
              <span>Prénom</span>
            </div>
          </th>
          <th>
            <div class="th-content">
              <i class="fas fa-calendar-alt"></i>
              <span>Date Naissance</span>
            </div>
          </th>
          <th>
            <div class="th-content">
              <i class="fas fa-venus-mars"></i>
              <span>Sexe</span>
            </div>
          </th>
          <th>
            <div class="th-content">
              <i class="fas fa-hospital"></i>
              <span>Établissement</span>
            </div>
          </th>
          <th>
            <div class="th-content">
              <i class="fas fa-cogs"></i>
              <span>Actions</span>
            </div>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of personnes">
          <td>{{ p.nom }}</td>
          <td>{{ p.prenom }}</td>
          <td>{{ p.dateNaissance | date:'dd/MM/yyyy' }}</td>
          <td>
            <span class="gender-badge" [class.male]="p.sexe === 'M'" [class.female]="p.sexe === 'F'">
              {{ p.sexe === 'M' ? 'Masculin' : 'Féminin' }}
            </span>
          </td>
          <td>{{ p.etablissementSanitaireId }}</td>
          <td class="actions-cell">
            <button class="action-btn edit" (click)="editPersonne(p)" title="Modifier">
              <i class="fas fa-edit"></i>
              <span>Modifier</span>
            </button>
            <button class="action-btn delete" *ngIf="p.id !== undefined" (click)="deletePersonne(p.id)" title="Supprimer">
              <i class="fas fa-trash-alt"></i>
              <span>Supprimer</span>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

